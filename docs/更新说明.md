# 更新说明

## 📋 版本历史

### v1.0.0 (2025-12-26)

#### 🎉 初始版本发布

**主要功能**:

1. **用户认证**
   - ✅ 管理员/员工登录
   - ✅ JWT Token认证
   - ✅ 密码加密存储

2. **健康证管理**
   - ✅ 健康证上传（支持图片格式：JPG/PNG/BMP）
   - ✅ OCR自动识别（PaddleOCR集成）
   - ✅ 健康证审核（通过/拒绝）
   - ✅ 健康证查询和历史记录

3. **员工管理**
   - ✅ 员工信息查询（分页）
   - ✅ 员工信息编辑（手机号、钉钉ID等）
   - ✅ 员工数据同步（从HR系统）

4. **部门管理**
   - ✅ 部门树状结构显示
   - ✅ 部门信息管理
   - ✅ 部门启用/禁用

5. **数据看板**
   - ✅ 统计卡片（总员工数、已提交、已通过、即将到期、已过期、没有健康证）
   - ✅ 数字颜色显示（蓝色/绿色/黄色/红色/紫色）
   - ✅ 下钻功能（点击统计卡片查看详细员工列表）
   - ✅ 状态分布饼图（颜色与统计卡片一致）
   - ✅ 部门统计柱状图

6. **系统配置**
   - ✅ 邮件配置（SMTP设置、测试发送）
   - ✅ 钉钉配置（Corp ID、App Secret）
   - ✅ 提醒规则配置（到期提醒天数）
   - ✅ 手动触发同步（员工/部门）

7. **提醒功能**
   - ✅ 健康证到期提醒（邮件/钉钉）
   - ✅ 定时任务（每天上午9点）

8. **导出功能**
   - ✅ Excel格式导出
   - ✅ PDF格式导出
   - ✅ 数据筛选导出

9. **操作日志**
   - ✅ 用户操作记录
   - ✅ 日志查询和筛选

**技术特性**:

- ✅ Spring Boot 2.7.18
- ✅ MyBatis-Plus 3.5.3
- ✅ MySQL 8.0
- ✅ Docker容器化部署
- ✅ Nginx反向代理
- ✅ JWT认证
- ✅ 双数据源（本地+远程HR系统）

**已知问题**:

- ⚠️ OCR识别超时：大图片（如TEST1.jpg）可能超时，需要增加OCR服务超时时间
- ⚠️ 图片预览：部分浏览器可能不支持全屏预览功能

---

## 🔄 更新记录

### 2025-12-26

#### 功能更新

1. **工作台下钻功能**
   - ✅ 添加统计卡片点击下钻功能
   - ✅ 显示详细员工列表（按部门排序）
   - ✅ 支持5种状态的下钻：已提交、已通过、即将到期、已过期、没有健康证

2. **数字颜色显示**
   - ✅ 已提交：蓝色（#3498db）
   - ✅ 已通过：绿色（#27ae60）
   - ✅ 即将到期：黄色（#f39c12）
   - ✅ 已过期：红色（#e74c3c）
   - ✅ 没有健康证：紫色（#9b59b6）

3. **状态分布图表优化**
   - ✅ 图表颜色与统计卡片一致
   - ✅ 已提交和待审核合并为一个蓝色项
   - ✅ 添加"没有健康证"状态到图表

4. **健康证管理优化**
   - ✅ 健康证审核模块改为健康证管理
   - ✅ 支持查看和审核两种模式
   - ✅ 添加状态筛选功能
   - ✅ 优化图片预览和全屏查看

5. **部门管理优化**
   - ✅ 树状结构显示
   - ✅ 显示主管姓名和部门人数
   - ✅ 支持展开/折叠

6. **员工管理优化**
   - ✅ 分页功能完善
   - ✅ 添加钉钉ID字段
   - ✅ 支持编辑员工信息

#### Bug修复

1. **修复登录问题**
   - ✅ 修复非admin账号无法登录的问题
   - ✅ 优化认证逻辑，优先检查本地账号

2. **修复OCR识别**
   - ✅ 修复OCR API调用格式
   - ✅ 添加类别字段提取
   - ✅ 优化字段提取正则表达式

3. **修复图片预览**
   - ✅ 修复图片加载失败问题
   - ✅ 优化图片URL构建逻辑
   - ✅ 修复Nginx静态资源代理配置

4. **修复健康证重新提交**
   - ✅ 允许已拒绝的健康证重新上传
   - ✅ 更新现有记录而不是创建新记录

5. **修复分页功能**
   - ✅ 修复MyBatis-Plus分页配置
   - ✅ 修复前端分页显示问题

#### 代码优化

1. **后端优化**
   - ✅ 优化数据库查询性能
   - ✅ 添加详细的中文注释
   - ✅ 统一异常处理
   - ✅ 优化日志输出

2. **前端优化**
   - ✅ 统一导航栏样式
   - ✅ 优化模态框交互
   - ✅ 添加加载状态提示
   - ✅ 优化错误提示信息

---

## 📝 升级指南

### 从旧版本升级

#### 步骤1：备份数据

```bash
# 备份数据库
docker-compose exec mysql mysqldump -uroot -proot123 health_cert_db > backup_$(date +%Y%m%d).sql

# 备份文件
docker cp health-cert-backend:/app/uploads ./backups/uploads_$(date +%Y%m%d)
```

#### 步骤2：更新代码

```bash
# 拉取最新代码
git pull origin main

# 或者重新克隆
git clone https://github.com/AprilZB/AP-health_cert.git
```

#### 步骤3：重新构建

```bash
# 重新构建后端镜像
docker-compose build backend

# 重启服务
docker-compose restart backend
```

#### 步骤4：验证升级

```bash
# 检查服务状态
docker-compose ps

# 检查日志
docker-compose logs backend

# 访问系统测试功能
```

---

## 🔮 未来计划

### v1.1.0 (计划中)

**功能计划**:

- [ ] 健康证批量审核
- [ ] 健康证批量导出
- [ ] 数据统计分析报表
- [ ] 移动端适配优化
- [ ] 消息通知中心

**性能优化**:

- [ ] Redis缓存集成
- [ ] 数据库读写分离
- [ ] CDN静态资源加速
- [ ] 图片压缩和优化

**安全增强**:

- [ ] HTTPS支持
- [ ] 操作审计日志
- [ ] 敏感数据加密
- [ ] 防暴力破解

---

## ⚠️ 重要提示

### 升级前必读

1. **数据备份**: 升级前务必备份数据库和文件
2. **测试环境**: 建议先在测试环境验证升级
3. **版本兼容**: 检查数据库版本兼容性
4. **配置检查**: 确认配置文件是否正确

### 已知限制

1. **OCR服务**: 依赖外部OCR服务，需要网络连通
2. **文件存储**: 文件存储在Docker卷中，注意备份
3. **并发限制**: 当前版本未做并发限制，大量用户可能影响性能

---

**最后更新**: 2025年12月26日

